---
title: "Final"
output: html_document
date: "2023-11-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# install.packages("tidycensus")
library(tidycensus)
library(tidyverse)
library(dplyr)
# install.packages("reader")
library(reader)
# install.packages("purrr")
library(purrr)
```

```{r}
# API key for tidycensus
census_api_key("879c99305c92c44bc76fa12b239039001ae1a69d", overwrite = TRUE, install = TRUE)
```

```{r}
# Load available variables for ACS 5-year 2021
variables <- load_variables(year = 2021, dataset = "acs5", cache = TRUE)

# Specific table codes
specific_tables <- c("B01002", "B05002", "B14001", "B11012", "B17020", "B19122", "B21001", "B22001", "B23025", "B28010")

# Loop to download and save data for each specified table
for (table_code in specific_tables) {
    # Filter variables for the current table, including label and concept
    current_table_variables <- subset(variables, grepl(paste0("^", table_code), variables$name), 
                                      select = c("name", "label", "concept"))

    # Download data for the current table
    acs_data <- get_acs(geography = "state", 
                        variables = current_table_variables$name, 
                        year = 2021, 
                        survey = "acs5")

    # Merge the data with labels and concepts for clarity
    acs_data_labeled <- merge(acs_data, current_table_variables, by.x = "variable", by.y = "name")

    # Save the merged data to CSV in the 'data' folder
    write.csv(acs_data_labeled, file.path("data", paste0(table_code, ".csv")), row.names = FALSE)
    }
```
```{r}
# Function to calculate proportions
calculate_proportion <- function(numerator, denominator) {
  return(numerator / denominator)
}

# Load datasets
b01002_df <- read.csv("data/B01002.csv")
b05002_df <- read.csv("data/B05002.csv")
b11012_df <- read.csv("data/B11012.csv")
b14001_df <- read.csv("data/B14001.csv")
b17020_df <- read.csv("data/B17020.csv")
b19122_df <- read.csv("data/B19122.csv")
b21001_df <- read.csv("data/B21001.csv")
b22001_df <- read.csv("data/B22001.csv")
b23025_df <- read.csv("data/B23025.csv")
b28010_df <- read.csv("data/B28010.csv")

# Calculate variables
b01002_df$median_age <- b01002_df$B01002_001
b05002_df$proportion_foreign_born <- calculate_proportion(b05002_df$B05002_013, b05002_df$B05002_001)
b11012_df$proportion_married_couple_families <- calculate_proportion(b11012_df$B11012_003, b11012_df$B11012_001)
b14001_df$proportion_school_enrolled <- calculate_proportion(b14001_df$B14001_002, b14001_df$B14001_001)
b17020_df$proportion_poverty <- calculate_proportion(b17020_df$B17020_002, b17020_df$B17020_001)
b19122_df$proportion_no_earners <- calculate_proportion(b19122_df$B19122_002, b19122_df$B19122_001)
b21001_df$proportion_veteran <- calculate_proportion(b21001_df$B21001_002, b21001_df$B21001_001)
b22001_df$proportion_received_food_stamps <- calculate_proportion(b22001_df$B22001_002, b22001_df$B22001_001)
b23025_df$proportion_not_in_labor_force <- calculate_proportion(b23025_df$B23025_007, b23025_df$B23025_001)
b28010_df$proportion_with_computing_devices <- calculate_proportion(b28010_df$B28010_002, b28010_df$B28010_001)

# Combine datasets as required for further analysis
combined_df <- merge(b01002_df[, c("GEOID", "median_age")],
                     b05002_df[, c("GEOID", "proportion_foreign_born")], 
                     by = "GEOID")
```

